会不会重复消费，如何避免
幂等性

引入 Redis，存入唯一标识 messageId。过期时间要大于消息超时时间。
# 消息丢失
生产者
	发送消息到MQ，网络延迟。
		改成同步发送，先发消息，发送成功处理后面业务逻辑。
		异步发送 + 重试 + 补偿
消息端
	mq 宕机，消息会存到 MQ 的内存中，响应给生产端，你的消息发送成功，异步刷盘的机制写到磁盘。宕机内存中的消息会丢，改为同步刷盘。
	但是主从集群的时候，仍然会存在丢失的场景。主从复制的时候，从节点挂了，从节点就会丢失消息。改为同步复制。
消费者
	业务处理异常，重试，但是要保证消息的幂等性。
# 消息顺序
![[Pasted image 20250716143903.png]]
发送：单一发送或者分布式锁串行发送，
消息队列：单一队列 全局有序，通过 MessageQueueSelector 保证消息在同一个组里面
消费：MessageListenerOrder